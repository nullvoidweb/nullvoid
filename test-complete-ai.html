<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NullVoid Extension - AI Test Complete</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .test-section h3 {
        margin-top: 0;
        color: #333;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
      }
      .info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
        color: #0c5460;
      }
      .warning {
        background-color: #fff3cd;
        border-color: #ffeaa7;
        color: #856404;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
      }
      #testResults {
        margin-top: 20px;
        white-space: pre-wrap;
        background-color: #f8f9fa;
        padding: 15px;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        max-height: 400px;
        overflow-y: auto;
      }
      .chat-test {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #fafafa;
      }
      #chatInput {
        width: 70%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 3px;
      }
      #chatMessages {
        height: 200px;
        overflow-y: auto;
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        background-color: white;
      }
      .message {
        margin: 5px 0;
        padding: 8px;
        border-radius: 5px;
      }
      .user-message {
        background-color: #007bff;
        color: white;
        text-align: right;
      }
      .ai-message {
        background-color: #e9ecef;
        color: #333;
      }
      .error-message {
        background-color: #f8d7da;
        color: #721c24;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ü§ñ NullVoid Extension - Complete AI Test Suite</h1>

      <div class="test-section info">
        <h3>üìã Test Overview</h3>
        <p>
          This page will test all AI functionality after fixing the model
          configuration issue.
        </p>
        <p>
          <strong>Fixed Issue:</strong> Updated model from "gemini-1.5-flash" to
          "gemini-2.5-flash"
        </p>
        <p><strong>API Key:</strong> AIzaSyB-j8iXAEg_W-I2l3PodnJMoO_wgai2VDU</p>
        <p><strong>Status:</strong> Ready to test</p>
      </div>

      <div class="test-section">
        <h3>üß™ Automated Tests</h3>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="testBasicAPI()">Test Basic API</button>
        <button onclick="testErrorHandling()">Test Error Handling</button>
        <button onclick="testSafetyFilters()">Test Safety Filters</button>
        <div id="testResults"></div>
      </div>

      <div class="test-section chat-test">
        <h3>üí¨ Interactive Chat Test</h3>
        <p>Test the AI chat functionality directly:</p>
        <div id="chatMessages"></div>
        <input
          type="text"
          id="chatInput"
          placeholder="Type your message here..."
          onkeypress="handleChatKeypress(event)"
        />
        <button onclick="sendChatMessage()">Send</button>
        <button onclick="clearChat()">Clear Chat</button>
      </div>

      <div class="test-section">
        <h3>üìä Extension Integration Tests</h3>
        <button onclick="openExtensionPopup()">Open Extension Popup</button>
        <button onclick="openFullAIChat()">Open Full AI Chat</button>
        <button onclick="testBrowserlessAPI()">Test Browserless API</button>
        <div id="integrationResults"></div>
      </div>
    </div>

    <script>
      const AI_CONFIG = {
        apiKey: "AIzaSyB-j8iXAEg_W-I2l3PodnJMoO_wgai2VDU",
        baseUrl: "https://generativelanguage.googleapis.com/v1beta",
        model: "gemini-2.5-flash",
      };

      let testResults = [];

      function logTest(testName, status, message) {
        const timestamp = new Date().toLocaleTimeString();
        const result = `[${timestamp}] ${testName}: ${status.toUpperCase()} - ${message}`;
        testResults.push(result);
        document.getElementById("testResults").textContent =
          testResults.join("\n");
        console.log(result);
      }

      async function testBasicAPI() {
        logTest("Basic API", "RUNNING", "Testing basic API connectivity...");

        try {
          const requestBody = {
            contents: [
              {
                parts: [{ text: "Say 'Hello from AI' if you can read this." }],
              },
            ],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 50,
            },
          };

          const response = await fetch(
            `${AI_CONFIG.baseUrl}/models/${AI_CONFIG.model}:generateContent?key=${AI_CONFIG.apiKey}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestBody),
            }
          );

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: ${await response.text()}`
            );
          }

          const data = await response.json();

          if (data.candidates && data.candidates[0]) {
            const text = data.candidates[0].content.parts[0].text;
            logTest("Basic API", "PASSED", `AI responded: "${text}"`);
            return true;
          } else {
            throw new Error("No valid response from API");
          }
        } catch (error) {
          logTest("Basic API", "FAILED", error.message);
          return false;
        }
      }

      async function testErrorHandling() {
        logTest(
          "Error Handling",
          "RUNNING",
          "Testing error handling with invalid request..."
        );

        try {
          // Test with invalid model
          const response = await fetch(
            `${AI_CONFIG.baseUrl}/models/invalid-model:generateContent?key=${AI_CONFIG.apiKey}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [{ parts: [{ text: "test" }] }],
              }),
            }
          );

          if (response.status === 404) {
            logTest(
              "Error Handling",
              "PASSED",
              "Correctly handled 404 error for invalid model"
            );
            return true;
          } else {
            logTest(
              "Error Handling",
              "FAILED",
              `Expected 404, got ${response.status}`
            );
            return false;
          }
        } catch (error) {
          logTest("Error Handling", "FAILED", error.message);
          return false;
        }
      }

      async function testSafetyFilters() {
        logTest(
          "Safety Filters",
          "RUNNING",
          "Testing safety filter configuration..."
        );

        try {
          const requestBody = {
            contents: [
              {
                parts: [{ text: "Write a simple greeting message." }],
              },
            ],
            generationConfig: {
              temperature: 0.7,
              maxOutputTokens: 100,
            },
            safetySettings: [
              {
                category: "HARM_CATEGORY_HARASSMENT",
                threshold: "BLOCK_MEDIUM_AND_ABOVE",
              },
              {
                category: "HARM_CATEGORY_HATE_SPEECH",
                threshold: "BLOCK_MEDIUM_AND_ABOVE",
              },
              {
                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                threshold: "BLOCK_MEDIUM_AND_ABOVE",
              },
              {
                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                threshold: "BLOCK_MEDIUM_AND_ABOVE",
              },
            ],
          };

          const response = await fetch(
            `${AI_CONFIG.baseUrl}/models/${AI_CONFIG.model}:generateContent?key=${AI_CONFIG.apiKey}`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestBody),
            }
          );

          if (!response.ok) {
            throw new Error(
              `HTTP ${response.status}: ${await response.text()}`
            );
          }

          const data = await response.json();

          if (data.candidates && data.candidates[0]) {
            logTest(
              "Safety Filters",
              "PASSED",
              "Safety settings configured correctly"
            );
            return true;
          } else {
            throw new Error("Safety filters blocked benign content");
          }
        } catch (error) {
          logTest("Safety Filters", "FAILED", error.message);
          return false;
        }
      }

      async function runAllTests() {
        testResults = [];
        logTest("Test Suite", "STARTED", "Running all automated tests...");

        const results = await Promise.all([
          testBasicAPI(),
          testErrorHandling(),
          testSafetyFilters(),
        ]);

        const passed = results.filter((r) => r).length;
        const total = results.length;

        if (passed === total) {
          logTest("Test Suite", "PASSED", `All ${total} tests passed! ‚úÖ`);
        } else {
          logTest("Test Suite", "FAILED", `${passed}/${total} tests passed`);
        }
      }

      async function sendAIMessage(message) {
        const requestBody = {
          contents: [
            {
              parts: [{ text: `You are a helpful AI assistant. ${message}` }],
            },
          ],
          generationConfig: {
            temperature: 0.7,
            maxOutputTokens: 500,
            topP: 0.8,
            topK: 40,
          },
          safetySettings: [
            {
              category: "HARM_CATEGORY_HARASSMENT",
              threshold: "BLOCK_MEDIUM_AND_ABOVE",
            },
            {
              category: "HARM_CATEGORY_HATE_SPEECH",
              threshold: "BLOCK_MEDIUM_AND_ABOVE",
            },
            {
              category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
              threshold: "BLOCK_MEDIUM_AND_ABOVE",
            },
            {
              category: "HARM_CATEGORY_DANGEROUS_CONTENT",
              threshold: "BLOCK_MEDIUM_AND_ABOVE",
            },
          ],
        };

        const response = await fetch(
          `${AI_CONFIG.baseUrl}/models/${AI_CONFIG.model}:generateContent?key=${AI_CONFIG.apiKey}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestBody),
          }
        );

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`API Error ${response.status}: ${errorText}`);
        }

        const data = await response.json();

        if (!data.candidates || data.candidates.length === 0) {
          throw new Error("No response from AI");
        }

        return data.candidates[0].content.parts[0].text;
      }

      function addChatMessage(message, isUser = false, isError = false) {
        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${
          isUser ? "user-message" : isError ? "error-message" : "ai-message"
        }`;
        messageDiv.textContent = message;
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      async function sendChatMessage() {
        const chatInput = document.getElementById("chatInput");
        const message = chatInput.value.trim();

        if (!message) return;

        addChatMessage(message, true);
        chatInput.value = "";

        try {
          const response = await sendAIMessage(message);
          addChatMessage(response, false);
        } catch (error) {
          console.error("Chat error:", error);
          addChatMessage(`Error: ${error.message}`, false, true);
        }
      }

      function handleChatKeypress(event) {
        if (event.key === "Enter") {
          sendChatMessage();
        }
      }

      function clearChat() {
        document.getElementById("chatMessages").innerHTML = "";
      }

      function openExtensionPopup() {
        const resultsDiv = document.getElementById("integrationResults");
        resultsDiv.innerHTML =
          '<div style="color: #856404;">‚ö†Ô∏è Please manually test the extension popup by clicking the extension icon in Chrome.</div>';
      }

      function openFullAIChat() {
        const resultsDiv = document.getElementById("integrationResults");
        resultsDiv.innerHTML =
          '<div style="color: #856404;">‚ö†Ô∏è Please manually open the full AI chat from the extension popup.</div>';
      }

      function testBrowserlessAPI() {
        const resultsDiv = document.getElementById("integrationResults");
        resultsDiv.innerHTML =
          '<div style="color: #856404;">‚ö†Ô∏è Browserless API requires valid credentials. Currently showing 403 Forbidden errors.</div>';
      }

      // Auto-run basic test on page load
      window.addEventListener("load", () => {
        setTimeout(() => {
          testBasicAPI();
        }, 1000);
      });
    </script>
  </body>
</html>
