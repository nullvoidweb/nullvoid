<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Test - NULL VOID AI</title>
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(
          135deg,
          #0f0f23 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        color: #e8eaed;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
      }
      .test-container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(15, 15, 35, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 30px;
        backdrop-filter: blur(30px);
      }
      .test-header {
        text-align: center;
        margin-bottom: 30px;
      }
      .test-section {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 20px;
        margin: 15px 0;
      }
      .test-button {
        background: rgba(66, 133, 244, 0.8);
        border: 1px solid rgba(66, 133, 244, 0.5);
        border-radius: 8px;
        color: white;
        padding: 12px 24px;
        cursor: pointer;
        margin: 5px;
        transition: all 0.2s ease;
      }
      .test-button:hover {
        background: rgba(66, 133, 244, 1);
        transform: translateY(-1px);
      }
      .success {
        color: #4caf50;
      }
      .error {
        color: #f44336;
      }
      .warning {
        color: #ff9800;
      }
      .console-output {
        background: #000;
        color: #0f0;
        padding: 15px;
        border-radius: 4px;
        height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
        margin-top: 10px;
      }
      .iframe-container {
        margin: 20px 0;
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <div class="test-header">
        <h1>üí¨ NULL VOID AI Input Test</h1>
        <p>Testing chat input and send message functionality</p>
      </div>

      <div class="test-section">
        <h3>üîç Quick Diagnostic Tests</h3>
        <button class="test-button" onclick="testBasicElements()">
          Test Basic Elements
        </button>
        <button class="test-button" onclick="testInputFunctionality()">
          Test Input Functionality
        </button>
        <button class="test-button" onclick="testSendButton()">
          Test Send Button
        </button>
        <button class="test-button" onclick="testEmergencyFunctions()">
          Test Emergency Functions
        </button>
        <button class="test-button" onclick="clearConsole()">
          Clear Console
        </button>
        <div class="console-output" id="consoleOutput"></div>
      </div>

      <div class="test-section">
        <h3>üéØ Live AI Chat Interface</h3>
        <p>Test the actual chat interface below:</p>
        <div class="iframe-container">
          <iframe
            id="chatFrame"
            src="http://localhost:8081/ai-chat-full.html"
            style="width: 100%; height: 500px; border: none"
          ></iframe>
        </div>
      </div>

      <div class="test-section">
        <h3>üõ†Ô∏è Manual Test Instructions</h3>
        <ol>
          <li>
            <strong>Click in the chat input field</strong> - Should be able to
            focus and type
          </li>
          <li>
            <strong>Type a message</strong> - Send button should become enabled
          </li>
          <li>
            <strong>Press Enter or click Send</strong> - Message should appear
            in chat
          </li>
          <li><strong>Check console</strong> - Look for any error messages</li>
        </ol>
      </div>
    </div>

    <script>
      const consoleOutput = document.getElementById("consoleOutput");

      function log(message, type = "info") {
        const time = new Date().toLocaleTimeString();
        const colors = {
          info: "#fff",
          success: "#4caf50",
          error: "#f44336",
          warning: "#ff9800",
        };

        consoleOutput.innerHTML += `<div style="color:${colors[type]}">[${time}] ${message}</div>`;
        consoleOutput.scrollTop = consoleOutput.scrollHeight;
        console.log(`[${time}] ${message}`);
      }

      function clearConsole() {
        consoleOutput.innerHTML = "";
        log("Console cleared", "info");
      }

      async function testBasicElements() {
        log("=== TESTING BASIC ELEMENTS ===", "info");

        try {
          const frame = document.getElementById("chatFrame");
          await waitForFrameLoad(frame);

          const frameDoc = frame.contentDocument;
          const frameWindow = frame.contentWindow;

          // Test elements
          const chatInput = frameDoc.getElementById("chatInput");
          const sendBtn = frameDoc.getElementById("sendBtn");
          const chatMessages = frameDoc.getElementById("chatMessages");

          log(
            `Chat Input: ${chatInput ? "‚úÖ Found" : "‚ùå Missing"}`,
            chatInput ? "success" : "error"
          );
          log(
            `Send Button: ${sendBtn ? "‚úÖ Found" : "‚ùå Missing"}`,
            sendBtn ? "success" : "error"
          );
          log(
            `Chat Messages: ${chatMessages ? "‚úÖ Found" : "‚ùå Missing"}`,
            chatMessages ? "success" : "error"
          );

          if (chatInput) {
            log(
              `Input disabled: ${chatInput.disabled}`,
              chatInput.disabled ? "warning" : "success"
            );
            log(
              `Input readonly: ${chatInput.readOnly}`,
              chatInput.readOnly ? "warning" : "success"
            );
            log(`Input placeholder: "${chatInput.placeholder}"`, "info");
          }

          if (sendBtn) {
            log(
              `Send button disabled: ${sendBtn.disabled}`,
              sendBtn.disabled ? "warning" : "info"
            );
          }

          // Test UI object
          if (frameWindow.nullVoidUI) {
            log("‚úÖ nullVoidUI object found", "success");
          } else {
            log("‚ùå nullVoidUI object missing", "error");
          }
        } catch (error) {
          log(`‚ùå Error in basic elements test: ${error.message}`, "error");
        }
      }

      async function testInputFunctionality() {
        log("=== TESTING INPUT FUNCTIONALITY ===", "info");

        try {
          const frame = document.getElementById("chatFrame");
          const frameDoc = frame.contentDocument;
          const frameWindow = frame.contentWindow;

          const chatInput = frameDoc.getElementById("chatInput");
          const sendBtn = frameDoc.getElementById("sendBtn");

          if (!chatInput) {
            log("‚ùå Chat input not found", "error");
            return;
          }

          // Test focus
          chatInput.focus();
          log("‚úÖ Input focused", "success");

          // Test typing
          chatInput.value = "";
          const testMessage = "Hello, this is a test message!";

          // Simulate typing
          for (let i = 0; i < testMessage.length; i++) {
            chatInput.value = testMessage.substring(0, i + 1);

            // Trigger input event
            const inputEvent = new Event("input", { bubbles: true });
            chatInput.dispatchEvent(inputEvent);

            await new Promise((resolve) => setTimeout(resolve, 50));
          }

          log(`‚úÖ Test message typed: "${testMessage}"`, "success");
          log(
            `Send button disabled after typing: ${sendBtn.disabled}`,
            sendBtn.disabled ? "error" : "success"
          );

          // Test clear
          chatInput.value = "";
          const clearEvent = new Event("input", { bubbles: true });
          chatInput.dispatchEvent(clearEvent);

          log(
            `Send button disabled after clearing: ${sendBtn.disabled}`,
            sendBtn.disabled ? "success" : "warning"
          );
        } catch (error) {
          log(
            `‚ùå Error in input functionality test: ${error.message}`,
            "error"
          );
        }
      }

      async function testSendButton() {
        log("=== TESTING SEND BUTTON ===", "info");

        try {
          const frame = document.getElementById("chatFrame");
          const frameDoc = frame.contentDocument;
          const frameWindow = frame.contentWindow;

          const chatInput = frameDoc.getElementById("chatInput");
          const sendBtn = frameDoc.getElementById("sendBtn");

          if (!chatInput || !sendBtn) {
            log("‚ùå Chat input or send button not found", "error");
            return;
          }

          // Type a test message
          const testMessage = "Test send functionality";
          chatInput.value = testMessage;

          // Trigger input event to enable send button
          const inputEvent = new Event("input", { bubbles: true });
          chatInput.dispatchEvent(inputEvent);

          log(`‚úÖ Test message set: "${testMessage}"`, "success");

          // Wait a moment
          await new Promise((resolve) => setTimeout(resolve, 500));

          // Try to click send button
          if (!sendBtn.disabled) {
            sendBtn.click();
            log("‚úÖ Send button clicked", "success");

            // Check if message was sent (input should be cleared)
            setTimeout(() => {
              if (chatInput.value === "") {
                log(
                  "‚úÖ Input cleared after send - message likely sent",
                  "success"
                );
              } else {
                log(
                  "‚ö†Ô∏è Input not cleared - check send functionality",
                  "warning"
                );
              }
            }, 1000);
          } else {
            log("‚ùå Send button is disabled, cannot click", "error");
          }
        } catch (error) {
          log(`‚ùå Error in send button test: ${error.message}`, "error");
        }
      }

      async function testEmergencyFunctions() {
        log("=== TESTING EMERGENCY FUNCTIONS ===", "info");

        try {
          const frame = document.getElementById("chatFrame");
          const frameWindow = frame.contentWindow;

          // Test emergency debug
          if (frameWindow.EMERGENCY_DEBUG_ELEMENTS) {
            frameWindow.EMERGENCY_DEBUG_ELEMENTS();
            log("‚úÖ EMERGENCY_DEBUG_ELEMENTS called", "success");
          } else {
            log("‚ùå EMERGENCY_DEBUG_ELEMENTS not found", "error");
          }

          // Test emergency focus
          if (frameWindow.EMERGENCY_FOCUS_INPUT) {
            frameWindow.EMERGENCY_FOCUS_INPUT();
            log("‚úÖ EMERGENCY_FOCUS_INPUT called", "success");
          } else {
            log("‚ùå EMERGENCY_FOCUS_INPUT not found", "error");
          }

          // Test emergency send
          if (frameWindow.EMERGENCY_SEND_MESSAGE) {
            frameWindow.EMERGENCY_SEND_MESSAGE(
              "Emergency test message from diagnostic tool"
            );
            log("‚úÖ EMERGENCY_SEND_MESSAGE called", "success");
          } else {
            log("‚ùå EMERGENCY_SEND_MESSAGE not found", "error");
          }
        } catch (error) {
          log(
            `‚ùå Error in emergency functions test: ${error.message}`,
            "error"
          );
        }
      }

      async function waitForFrameLoad(frame) {
        return new Promise((resolve) => {
          if (frame.contentDocument.readyState === "complete") {
            resolve();
          } else {
            frame.onload = resolve;
          }
        });
      }

      // Auto-run basic test when frame loads
      setTimeout(() => {
        log("üöÄ Auto-running basic diagnostic...", "info");
        testBasicElements();
      }, 2000);

      log(
        "üéØ Input Test Ready - The chat interface should load below",
        "success"
      );
      log("üí° Try typing in the chat input field and clicking send", "info");
    </script>
  </body>
</html>
