<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Console Test - NULL VOID Functions</title>
    <style>
      body {
        font-family: monospace;
        background: #1a1a2e;
        color: #e8eaed;
        padding: 20px;
        line-height: 1.6;
      }
      .test-panel {
        background: rgba(15, 15, 35, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 20px;
        margin: 10px 0;
      }
      button {
        background: #4285f4;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #3367d6;
      }
      .output {
        background: #000;
        color: #0f0;
        padding: 15px;
        border-radius: 4px;
        height: 200px;
        overflow-y: auto;
        font-size: 12px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>ðŸ§ª NULL VOID Console Function Test</h1>

    <div class="test-panel">
      <h3>Direct Global Function Tests</h3>
      <button onclick="testGlobalFunctions()">Test Global Functions</button>
      <button onclick="testEmergencyFunctions()">
        Test Emergency Functions
      </button>
      <button onclick="testDirectAccess()">Test Direct Element Access</button>
      <button onclick="clearOutput()">Clear Output</button>
      <div class="output" id="output"></div>
    </div>

    <iframe
      id="testFrame"
      src="http://localhost:8080/ai-chat-full.html"
      style="
        width: 100%;
        height: 400px;
        border: 1px solid #333;
        border-radius: 8px;
        margin-top: 20px;
      "
    ></iframe>

    <script>
      const output = document.getElementById("output");

      function log(message, type = "info") {
        const time = new Date().toLocaleTimeString();
        const color =
          type === "error" ? "#f44" : type === "success" ? "#4f4" : "#fff";
        output.innerHTML += `<div style="color:${color}">[${time}] ${message}</div>`;
        output.scrollTop = output.scrollHeight;
        console.log(`[${time}] ${message}`);
      }

      function clearOutput() {
        output.innerHTML = "";
        log("Output cleared", "info");
      }

      async function testGlobalFunctions() {
        log("=== TESTING GLOBAL FUNCTIONS ===", "info");

        try {
          const frame = document.getElementById("testFrame");
          const frameWindow = frame.contentWindow;

          await new Promise((resolve) => {
            if (frame.contentDocument.readyState === "complete") {
              resolve();
            } else {
              frame.onload = resolve;
            }
          });

          log("Frame loaded successfully", "success");

          // Test hamburger global function
          if (typeof frameWindow.toggleSidebarExtension === "function") {
            log("âœ… toggleSidebarExtension function found", "success");
            frameWindow.toggleSidebarExtension();
            log("âœ… toggleSidebarExtension() called successfully", "success");
          } else {
            log("âŒ toggleSidebarExtension function not found", "error");
          }

          // Test search global function
          if (typeof frameWindow.toggleSearchExtension === "function") {
            log("âœ… toggleSearchExtension function found", "success");
            frameWindow.toggleSearchExtension();
            log("âœ… toggleSearchExtension() called successfully", "success");
          } else {
            log("âŒ toggleSearchExtension function not found", "error");
          }

          // Test nullVoidUI object
          if (frameWindow.nullVoidUI) {
            log("âœ… nullVoidUI object found", "success");
            log(
              `ðŸ“Š nullVoidUI methods: ${Object.getOwnPropertyNames(
                Object.getPrototypeOf(frameWindow.nullVoidUI)
              ).join(", ")}`,
              "info"
            );
          } else {
            log("âŒ nullVoidUI object not found", "error");
          }
        } catch (error) {
          log(`âŒ Error in global function test: ${error.message}`, "error");
        }
      }

      async function testEmergencyFunctions() {
        log("=== TESTING EMERGENCY FUNCTIONS ===", "info");

        try {
          const frame = document.getElementById("testFrame");
          const frameWindow = frame.contentWindow;

          // Test emergency hamburger
          if (typeof frameWindow.EMERGENCY_TOGGLE === "function") {
            log("âœ… EMERGENCY_TOGGLE function found", "success");
            frameWindow.EMERGENCY_TOGGLE();
            log("âœ… EMERGENCY_TOGGLE() called successfully", "success");
          } else {
            log("âŒ EMERGENCY_TOGGLE function not found", "error");
          }

          // Test emergency search
          if (typeof frameWindow.EMERGENCY_SEARCH_TOGGLE === "function") {
            log("âœ… EMERGENCY_SEARCH_TOGGLE function found", "success");
            frameWindow.EMERGENCY_SEARCH_TOGGLE();
            log("âœ… EMERGENCY_SEARCH_TOGGLE() called successfully", "success");
          } else {
            log("âŒ EMERGENCY_SEARCH_TOGGLE function not found", "error");
          }
        } catch (error) {
          log(`âŒ Error in emergency function test: ${error.message}`, "error");
        }
      }

      async function testDirectAccess() {
        log("=== TESTING DIRECT ELEMENT ACCESS ===", "info");

        try {
          const frame = document.getElementById("testFrame");
          const frameDoc = frame.contentDocument;

          // Test hamburger button
          const hamburgerBtn = frameDoc.getElementById("sidebarToggle");
          if (hamburgerBtn) {
            log("âœ… Hamburger button element found", "success");
            log(
              `ðŸ“Š Hamburger onclick: ${
                hamburgerBtn.onclick ? "SET" : "NOT SET"
              }`,
              "info"
            );
            hamburgerBtn.click();
            log("âœ… Hamburger button clicked directly", "success");
          } else {
            log("âŒ Hamburger button element not found", "error");
          }

          // Test search button
          const searchBtn = frameDoc.getElementById("searchBtn");
          if (searchBtn) {
            log("âœ… Search button element found", "success");
            log(
              `ðŸ“Š Search onclick: ${searchBtn.onclick ? "SET" : "NOT SET"}`,
              "info"
            );
            searchBtn.click();
            log("âœ… Search button clicked directly", "success");
          } else {
            log("âŒ Search button element not found", "error");
          }

          // Test sidebar and search panel
          const sidebar = frameDoc.getElementById("sidebar");
          const searchPanel = frameDoc.getElementById("searchPanel");

          if (sidebar) {
            log(
              `ðŸ“Š Sidebar transform: ${getComputedStyle(sidebar).transform}`,
              "info"
            );
          } else {
            log("âŒ Sidebar element not found", "error");
          }

          if (searchPanel) {
            log(`ðŸ“Š Search panel classes: ${searchPanel.className}`, "info");
          } else {
            log("âŒ Search panel element not found", "error");
          }
        } catch (error) {
          log(`âŒ Error in direct access test: ${error.message}`, "error");
        }
      }

      // Auto-run basic test when frame loads
      setTimeout(() => {
        log("ðŸš€ Auto-running basic connectivity test...", "info");
        testGlobalFunctions();
      }, 2000);

      log(
        "ðŸŽ¯ Console Test Ready - Check the iframe and click test buttons",
        "success"
      );
    </script>
  </body>
</html>
